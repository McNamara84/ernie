; PHP-FPM Pool Configuration for ERNIE
; ======================================
; This configuration optimizes PHP-FPM for the ERNIE application running in Docker.
; Key optimizations:
; - Dynamic process management for efficient resource usage
; - Increased limits for Inertia.js pages with large payloads
; - Proper logging for debugging

[www]
; Unix user/group of the child processes.
user = www-data
group = www-data

; Listen on TCP socket (used by Nginx to communicate with PHP-FPM)
listen = 9000

; Process manager settings
; ========================
; 'dynamic' creates child processes on-demand, which is efficient for varying load.
pm = dynamic

; Maximum number of child processes (increase for high-traffic sites)
pm.max_children = 20

; Number of child processes created on startup
pm.start_servers = 4

; Minimum number of idle server processes
pm.min_spare_servers = 2

; Maximum number of idle server processes
pm.max_spare_servers = 6

; Number of requests each child should process before respawning
; This helps prevent memory leaks from accumulating
pm.max_requests = 500

; Request termination timeout (should match PHP max_execution_time)
request_terminate_timeout = 120s

; Slow log for debugging performance issues
; Logs requests that take longer than this threshold
slowlog = /proc/self/fd/2
request_slowlog_timeout = 10s

; Clear environment variables for security
; Set to 'no' to pass environment variables from parent process
clear_env = no

; Catch worker output (redirect stdout/stderr to main error log)
catch_workers_output = yes

; Decorate worker output with request info
decorate_workers_output = no
